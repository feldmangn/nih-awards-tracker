pip install pgeocode
python - <<'PY'
import json, pandas as pd, pgeocode
df = pd.read_csv("data/nih_awards_last_90d.csv", dtype=str)
zips = (
    df["Place Of Performance ZIP Code"]
      .dropna().astype(str).str.extract(r"(\d{5})")[0].dropna().unique().tolist()
)
nomi = pgeocode.Nominatim('us')
out = {}
for z in zips:
    rec = nomi.query_postal_code(z)
    if pd.notna(rec.latitude) and pd.notna(rec.longitude):
        out[z] = {
            "lat": float(rec.latitude),
            "lon": float(rec.longitude),
            "state": rec.state_code or "",
            "city": rec.place_name or ""
        }
with open("data/zip_centroids.json","w") as f:
    json.dump(out, f)
print(f"Saved {len(out)} ZIP centroids to data/zip_centroids.json")
PY
